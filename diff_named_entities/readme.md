# Comparing different versions of (named) entity annotations

## Collecting and sampling different annotations

### Text file based workflow

The first (old) workflow contains scripts for running named entity (NE) recognizer on a PostgreSQL collection, comparing old and new named entity annotations, writing found differences (with their respective contexts) into a text file, and picking a random subset of differences (for manual checking). 

Requirements: Python 3.6+, [Psycopg 2](https://www.psycopg.org), EstNLTK v1.6.8+

* `diff_ner_tagger.py` -- Runs NerTagger on given PostgreSQL collection that has named entity annotations. Finds differences between old and new NE annotations. Outputs summarized statistics about differences, and writes all differences into a file. For detailed usage information, run: `python diff_ner_tagger.py -h`

* `diff_ner_tagger_models.py` -- Runs two NerTagger's models on given PostgreSQL collection, and finds differences between NE annotations produced by two models. Outputs summarized statistics about differences, and writes all differences into a file. _Note:_ The collection must have input layers required by NerTagger. For detailed usage information, run: `python diff_ner_tagger_models.py -h`

* `pick_randomly_from_diffs.py` -- Selects a random subset of differences from an output file produced by a difference finding script. For detailed usage information, run: `python pick_randomly_from_diffs.py -h`

* [`ner_diff_finder.ipynb`](ner_diff_finder.ipynb) -- tutorial exemplifying usage of `NerDiffFinder` (component which helps to find and group differences between two NE layers).

### Sqlite and Labelstudio based workflow

The second (new) workflow contains scripts for collecting differing NE annotations from an already annotated PostgreSQL collection, saving into an sqlite database, subsampling from the collected samples and creating a label-studio task (for manual annotation). 

The scripts are wrappers for functions that can also be imported and used in other python files. They can also be parameterized to work on any label attributes (doesn't have to be nertag).

Requirements: Python 3.9+, [Psycopg 2](https://www.psycopg.org), EstNLTK v1.7+

* `diff_collect.py` -- Collects differing annotations between two layers of texts from a PostgreSQL collection. Afterwards saves them into an sqlite database. See `python diff_collect.py -h` for usage details.

* `diff_sample.py` -- Samples annotations from the sqlite database generated by `diff_collect.py` and creates a label-studio task for picking the correct one. See `python diff_sample.py -h` for usage details.
